# なるはや Ruby on Rails - 浦嶌啓太(@ursm)

「速さは正義です。」
ということで、限られた開発リソースの中でいかにRailsアプリケーションを速くするかというテーマでお話されました。

浦嶌さんは永和システムマネジメントのチーフプログラマとして活躍されており、
数多くのRailsアプリケーション開発の経験をお持ちです。

その経験の中から、Railsアプリケーションを「なるはや」にするためのポイントとして次のふたつに焦点を絞って紹介されました。

* アプリケーションサーバの違い
* background worker のご紹介

それぞれついて詳しく見てみましょう。

## アプリケーションサーバの違い

Railsアプリケーションは一度にひとつのリクエストしか処理できません。
他のリクエストを処理している最中に発生したリクエストは待たされます。
そうすると、処理能力を超えるリクエストが発生するとアプリケーションは停止してしまいます。
これを防ぐためには並行にリクエストを処理する必要性がでてきます。

並行処理にはいくつかの戦略があります。

* マルチスレッド
* マルチプロセス
* Reactorパターン

それぞれのパターンの得手不得手があるため、
アプリケーションの特徴によってどの戦略が効果的かというのは異なってきます。

RailsのアプリケーションサーバにはPassengerやThinなどいくつかの種類があり、
それぞれ採用しているパターンが異なっています。

それを踏まえると、使い分け基準は次のようになるとのことです。

* Passenger, Unicornはマルチプロセスモデルで汎用性が高い
* Pumaはマルチスレッドモデルで、I/Oバウンドな処理が多いアプリケーションに向いている
* ThinはReactorパターンで実装されておりIOに時間がかかる接続に対してプロセスが張り付かないため、フロントのWebサーバがいない場合に向いている

## background worker のご紹介

background worker とは、"特定の処理 (ジョブ) をアプリケーションとは別のプロセスで非同期実行する仕組み" とのことです。
メール送信や検索インデックスの更新など、すぐにやらなくてもいい処理を後回しにすることで速やかにレスポンスを返すことができます。

Railsから利用できるbackground workerにもいろいろな実装があり、それぞれに特徴があります。

* [Delayed::Job](https://github.com/collectiveidea/delayed_job)
* [Resque](https://github.com/resque/resque)
* [Sidekiq](http://sidekiq.org/)
* [queue_classic](https://github.com/ryandotsmith/queue_classic)
* [girl_friday](http://mperham.github.io/girl_friday)

これらはジョブの保存先(オンメモリ/RDB/Redis)やワーカの動作方法(スレッド/プロセス)の違いがあり、
遅延させたい処理の内容によって使い分けるとよさそうです。

## まとめ

Railsアプリケーションをなるはやにするために、
アプリケーションの特性にあわせたアプリケーションサーバ/background workerを選択することが大事である、と発表を締めくくられました。
