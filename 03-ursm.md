# なるはや Ruby on Rails - 浦嶌啓太(@ursm)

「速さは正義です。」
ということで、限られた開発リソースの中でいかに Rails アプリケーションをはやくするかというテーマでお話されました。
> TODO: ここの背景ってなんやっけー、というのを動画見返す

浦嶌さんは永和システムマネジメントのチーフプログラマとして活躍されており、
数多くのRailsアプリケーション開発の経験をお持ちです。

その経験の中から、Railsアプリケーションを「なるはや」にするためのポイントとして次のふたつに焦点を絞って紹介されました。

* アプリケーションサーバの違い
* background worker のご紹介

それぞれついて詳しく見てみましょう。

## アプリケーションサーバの違い

Railsアプリケーションは一度にひとつのリクエストしか処理できません。
他のリクエストを処理している最中に発生したリクエストは待たされます。
そうすると、処理能力を超えるリクエストが発生するとアプリケーションは停止してしまいます。

そこで、並行にリクエストを処理する必要性がでてきます。
並行処理にはいくつかの戦略があります。

* マルチスレッド
* マルチプロセス
* Reactor パターン

それぞれのパターンの得手不得手があるため、
アプリケーションの特徴によってどの戦略が効果的かというのは異なってきます。

Railsのアプリケーションサーバにはいくつかの種類があり、
それぞれ採用しているパターンが異なっています。

それを踏まえると、 使い分け基準は次のようになることです。

* Passenger, Unicorn はマルチプロセスモデルで汎用性が高い
* Puma はマルチスレッドモデルで、I/Oバウンドな処理が多いアプリケーションに向いている
* Thin はマルチスレッドモデルで起動することができ、フロントのWebサーバがいないときに向いている

> TODO Thin オススメの理由ってもう少しあった、ような...

## background worker のご紹介

background worker とは、"特定の処理 (ジョブ) をアプリケーションとは別のプロセスで非同期実行する仕組み" とのことです。
メール送信や検索インデックスの更新など、すぐにやらなくてもいい処理を後回しにすることで早くレスポンスを返すことができます。

Rails から利用できる background worker にもいろいろな実装があり、それぞれに特徴があります。

* Delayed::Job
* Resque
* Sidekiq
* queue_classic
* girl_friday

これらはジョブの保存先(オンメモリ/RDB/Redis)やワーカの動作方法(スレッド/プロセス)の違いがあり、
遅延させたい処理の内容によって使い分けるとよさそうです。

## まとめ

> TODO もう一言あるとよい...?

Railsアプリケーションをはるはやにするために、
アプリケーションの特性にあわせたアーキテクチャを選択することが大事である、と発表を締めくくられました。
